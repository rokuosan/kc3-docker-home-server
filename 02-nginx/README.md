# Step:02 Webサーバーをホストしてみよう

このステップでは Web サーバーとして nginx をホストします。

一度手元の環境で`http://localhost:8080` に接続してみてください。
通常なら 8080 番ポートで待ち受けしているプログラムはないため、接続に失敗するでしょう。

ではこの状態で、以下のコマンドを実行してください。

```shell
docker run --rm -p 8080:80 nginx:latest
```

このコマンドが実行されている間に、任意のブラウザから`http://localhost:8080` にアクセスしてみてください。
（VSCode で devcontainer を利用している場合は右下に通知が来るので Open in browser を選択してください。）

うまく Web サーバーが起動していれば「Welcome to nginx!」と表示されます。

これで Docker を使って Web サーバーをホスティングできました。

## 停止方法

停止する時は、`CTRL + C` を押すことでフォアグラウンドのプロセスを終了できます。
この手法は、コンテナを停止するほか、今後のログを見たりする際などにも利用するので覚えておいてください。

## `localhost:8080` で接続できたのはなぜだろう

前述したコマンドを実行することで、以前は接続できなかった`localhost:8080` へ接続できるようになっていました。

これがなぜかを考えてみましょう。

このコマンドの`-p 8080:80` という部分に注目してください。この`-p` というオプションは続くポート番号の組み合わせでホストとコンテナのポートを公開します。組み合わせは`-p ホスト:コンテナ` の順で対応します。
このホスト部分には IP アドレスを指定できます。
例えば`-p 127.0.0.1:8080:80` のように書くとホストマシンにおける`127.0.0.1` という IP アドレスの`8080` 番と、コンテナの`80` 番ポートをマッピングさせることができます。
今回のようにホスト部分の IP アドレスについては省略できますが、その場合`0.0.0.0` を暗黙的に使用します。

ここでの注意点ですが、何も考えずに`-p` を使用していると「ファイアウォール(iptables, ufw)で drop しているはずなのになぜか接続が許可される」ということがおきます。理由について深くは述べませんが、Docker が独自の iptables のルールを持っているためです。
詳細については、以下のページが参考になります。

- [Packet filtering and firewalls | Docker Docs](https://docs.docker.com/engine/network/packet-filtering-firewalls/)

このような状態を回避するためには`--expose` オプションを使うと良いでしょう。
