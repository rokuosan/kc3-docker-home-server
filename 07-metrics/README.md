# Step:07 インフラの監視をしてみよう

これまでのステップでサーバーを立てることはできました。

サービスを公開して、その次にすることはなんでしょうか。
継続的な保守やアップデートなどがあるでしょう。

ではそれらを行う際に何を指標にすれば良いのでしょうか。
また、サーバーのエラー発生などに常に気付けるでしょうか。

それらを考える手法として監視や可視化というものがあります。
（最近ではオブザーバビリティという言葉も聞くようになってきた）

このステップでは、モニタリングツールとして Grafana と Prometheus をホスティングしてみます。

## サービスを起動

普段通り、この README が存在するディレクトリにある`compose.yaml` をもとにサービスを起動してください。

## Prometheus

Prometheus は設定ファイルに登録された対象へ向けてデータを定期的に取得するアプリケーションです。

接続する場合は`localhost:9090` へ接続してください。

メニューバーの Status から Targets を見ると情報を取得する対象を確認できます。
(`http://localhost:9090/targets`)

## Grafana への接続

Grafana は設定したデータソースから取得したデータをきれいに加工して可視化をするためのアプリケーションです。

ダッシュボードへ接続する場合は`localhost:3000` へ接続してください。

パスワードを求められますが、admin ユーザーが最初から登録されているのでそのユーザーでログインします。
認証情報を以下に示します。ログイン後にパスワードの再設定が求められますが、今回はスキップしてください。（本運用する際はパスワードを再設定してください）

| name  | password |
| :---- | :------- |
| admin | admin    |

Grafana はそのままの状態では何も使えないので、Prometheus との連携をしていきます。

Prometheus との接続をするには Connections から Data sources を選び、一覧から Prometheus を選択してください。

フォームの「Prometheus server URL」に Prometheus のサービス名を書きます。(例: `http://prometheus:9090`)

入力後にページ下部の「Save & test」を押してください。
正常に接続されてれば、「Successfully queried the Prometheus API.」と表示されます。

最後にダッシュボードを作成します。

今回はすでに作成されているダッシュボードを利用します。

Dashboards から New ボタンを押して、Import を選択してください。
「Find an ...」と書かれている入力欄に「1860」を入力して Load ボタンを押してください。

ページ下部に仕様する Prometheus のデータソースを選ぶドロップダウンが出現するので、先ほど作成したデータソースを選択しましょう。

うまくいけば、ダッシュボードが作成されます。

ここまでの作業を進めた時点ではデータが十分に収集されていないため、きれいな表示はまだわからないでしょう。
少し時間をおいて確認すると、データが集まるため、きれいなグラフが表示されます。
